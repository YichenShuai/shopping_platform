{% extends 'base.html' %}

{% block title %}My Account{% endblock %}

{% block content %}
<h1>My account</h1>
{% if messages %}
    {% for message in messages %}
        <p{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</p>
    {% endfor %}
{% endif %}
<div>
    <h2>Personal Information</h2>
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="edit_profile" value="1">
        {{ edit_form.as_p }}
        <button type="submit">Save changes</button>
    </form>
    <p>Balance: ${{ user.balance | floatformat:2 }}</p>
    {% if user.is_buyer %}
        <p><a href="{% url 'order_history' %}">Order History</a></p>
    {% endif %}
    {% if user.is_seller %}
        <p><a href="{% url 'manage_inventory' %}">Inventory Management</a></p>
        <p><a href="{% url 'seller_orders' %}">Seller order</a></p>
    {% endif %}
</div>
<div>
    <h2>Delivery address management</h2>
    {% if addresses %}
        {% for address in addresses %}
            <div class="address-card">
                <p>{{ address.address_line1 }}</p>
                <p>{{ address.address_line2|default:'' }}</p>
                <p>{{ address.city }}, {{ address.state }}, {{ address.postal_code }}, {{ address.country }}</p>
                {% if address.is_default %}<p><strong>Default Address</strong></p>{% endif %}
                <form method="post" action="{% url 'myaccount' %}">
                    {% csrf_token %}
                    <input type="hidden" name="address_id" value="{{ address.id }}">
                    <input type="hidden" name="delete_address" value="1">
                    <button type="submit">Delete</button>
                </form>
            </div>
        {% endfor %}
    {% else %}
        <p>No delivery address yet.</p>
    {% endif %}
    <h3>Add New Address</h3>
    <form method="post" action="{% url 'myaccount' %}">
        {% csrf_token %}
        <input type="hidden" name="add_address" value="1">
        {{ address_form.as_p }}
        <button type="submit">Add Address</button>
    </form>
</div>
<p><a href="{% url 'product_list' %}">Return to product list</a></p>
{% endblock %}