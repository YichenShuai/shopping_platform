<!DOCTYPE html>
<html>
<head>
    <title>Shopping - Order history</title>
</head>
<body>
    <h1>Order history</h1>
    {% if messages %}
        {% for message in messages %}
            <p{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</p>
        {% endfor %}
    {% endif %}
    {% if orders %}
        <ul>
            {% for order in orders %}
                <li>
                    order #{{ order.id }} - total: ${{ order.total_amount | floatformat:2 }}
                    - status: {{ order.status }}
                    - payment status: {{ order.payment_status }}
                    - order time: {{ order.created_at }}
                    {% if order.shipped_at %}
                        - shipped time: {{ order.shipped_at }}
                    {% endif %}
                    {% if order.refunded_at %}
                        - refund time: {{ order.refunded_at }}
                    {% endif %}
                    <ul>
                        {% for item in order.items.all %}
                            <li>{{ item.product.name }} - quantity: {{ item.quantity }} - price: ${{ item.price | floatformat:2 }}</li>
                        {% endfor %}
                    </ul>
                    {% if order.status in 'Shipped,Delivered' and not order.return_requested %}
                        <a href="{% url 'request_return' order.id %}">Request a return</a>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No orders yet</p>
    {% endif %}
    <p><a href="{% url 'product_list' %}">Return to product list</a></p>
</body>
</html>